# 登録機能のパスワードブロック問題修正（2025年1月19日）

## 問題の概要
ユーザーの環境で、ブラウザ拡張機能またはセキュリティソフトウェアが、パスワードフィールドを傍受し、`password: "actual_value"` を `passwordLength: 12` に変換していた。

## 実施した修正

### 1. サーバー側でのパスワードブロック検出
- `/app/api/auth/register/route.ts`に`passwordLength`フィールドの検出機能を追加
- 特定のエラーコード`PASSWORD_BLOCKED`と分かりやすいメッセージを返すように実装

### 2. 標準化されたAPIレスポンス形式
- `/src/utils/apiResponse.ts`を新規作成
- `successResponse`と`errorResponse`関数で一貫性のあるレスポンス形式を実装
- すべてのエラーにリクエストIDを付与

### 3. メール送信の安定化
- `/src/lib/email/service.ts`にリトライロジック実装（最大3回）
- リトライ不可能なエラーの判定機能追加
- `/src/lib/email/client.ts`にタイムアウト設定追加

### 4. フロントエンドのエラーハンドリング
- `/app/auth/register/page.tsx`で`PASSWORD_BLOCKED`エラーの特別処理
- デバッグログの詳細化

### 5. 環境変数チェック
- 必須環境変数の起動時チェック機能追加
- 不足時は503エラーを返す

## 結果
- ビルドテスト成功
- パスワードブロック問題に対する適切なエラーメッセージ表示
- メール送信の安定性向上

## 推奨事項
- ユーザーにはブラウザ拡張機能の一時無効化を推奨
- 将来的にFormData形式での送信も検討（セキュリティソフトの干渉を回避）