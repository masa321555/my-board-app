# 新規登録ペイロード問題 - 2025年1月19日

## 問題の症状
ユーザーから報告された問題：
- 新規登録フォームで「登録をする」をクリックすると「ユーザー登録に失敗しました」と表示される
- しかし実際にはユーザー登録は成功しており、ログインも可能
- ブラウザの開発者ツールで確認すると、送信ペイロードに`passwordLength`と`confirmPasswordLength`のみが含まれ、実際のパスワード値が送信されていない

## 実施した修正

### 1. フロントエンドの修正
`/app/auth/register/page.tsx`:
- 送信データを明示的に再構成してログ出力
- `bodyToSend`変数で実際の送信データを確認

### 2. サーバー側の修正
`/app/api/auth/register/route.ts`:
- パスワードフィールドの存在を明示的にチェック
- 詳細なエラーレスポンスを返す（`MISSING_PASSWORD`エラーコード）
- リクエストボディの完全な内容をログ出力

## 根本原因の可能性
1. **ブラウザ拡張機能の干渉**
   - パスワードマネージャーやセキュリティ拡張機能がパスワードフィールドを除去している可能性

2. **セキュリティソフトウェア**
   - アンチウイルスソフトやファイアウォールがHTTPリクエストを変更している可能性

3. **ブラウザの仕様**
   - 特定のブラウザでセキュリティ機能が動作している可能性

## 推奨される対処法
1. 異なるブラウザでテスト（Chrome、Firefox、Safari）
2. ブラウザ拡張機能を無効化してテスト
3. プライベートブラウジングモードでテスト
4. 開発者ツールのNetworkタブで実際の送信ペイロードを確認

## 代替案
問題が継続する場合：
1. FormDataを使用した送信方式への変更
2. axiosライブラリの使用
3. 送信前のデータ検証とフォールバック処理の実装